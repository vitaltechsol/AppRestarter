<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8' />
    <title>AppRestarter Web UI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        button {
            width: 260px;
            height: 80px;
            margin: 5px;
            font-size: 22px;
            cursor: pointer;
            color: white
        }

        #status {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h2>AppRestarter Web UI</h2>
    <div id='buttons'></div>
    <div id='status'></div>

    <script>
        async function loadApps() {
            const res = await fetch('/apps');
            if (!res.ok) {
                document.getElementById('status').innerText = 'Failed to load apps';
                return;
            }
            const apps = await res.json();
            const container = document.getElementById('buttons');
            container.innerHTML = '';
            apps.forEach(app => {
                const btn = document.createElement('button');
                btn.innerText = app.Name;
                btn.style.backgroundColor = app.ClientIP ? '#5a90f2' : '#5a63f2';
                btn.onclick = () => restartApp(app); // pass whole app
                container.appendChild(btn);
            });
        }

        async function restartApp(app) {
            // If NoWarn is false (or missing), ask for confirmation
            const shouldWarn = (app.NoWarn === false || app.NoWarn === undefined);
            if (shouldWarn) {
                const ok = window.confirm(`Are you sure you want to restart "${app.Name}"?`);
                if (!ok) return;
            }

            document.getElementById('status').innerText = `Restarting ${app.Name}...`;
            const res = await fetch('/restart', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ Name: app.Name })
            });
            if (res.ok) {
                document.getElementById('status').innerText = `${app.Name} restart triggered successfully.`;
            } else {
                const text = await res.text();
                document.getElementById('status').innerText = `Failed to restart ${app.Name}: ${text}`;
            }
        }

        window.onload = loadApps;
    </script>

</body>
</html>